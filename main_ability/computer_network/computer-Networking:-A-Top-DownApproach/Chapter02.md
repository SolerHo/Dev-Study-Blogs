<h1 align="center">ğŸ“” Chapter02 åº”ç”¨å±‚ å­¦ä¹ ç¬”è®°</h1>

## 


## 1. åº”ç”¨å±‚åè®®åŸç†

### 1.1 ä¸€äº›ç½‘ç»œåº”ç”¨
- E-mail
- Web
- Text Massage
- Remote Login
- P2P file sharingï¼ˆå¯¹ç­‰æ–‡ä»¶å…±äº«ï¼‰
- multi-user network games
- è§†é¢‘å­˜å‚¨æµï¼ˆYoutubeã€Netflixã€Huluï¼‰
- IPè§†é¢‘ä¼šè®®ï¼ˆSkypeï¼‰
- ç¤¾äº¤ç½‘ç»œï¼ˆFacebookã€Twitterï¼‰
- å®æ—¶è§†é¢‘ä¼šè®®
- æœç´¢


### 1.2 ç ”å‘ä¸€ä¸ªç½‘ç»œåº”ç”¨ç¨‹åº

- æ ¸å¿ƒï¼šå†™å‡ºèƒ½å¤Ÿè¿è¡Œåœ¨ä¸åŒçš„ç«¯ç³»ç»Ÿå’Œé€šè¿‡ç½‘ç»œå½¼æ­¤é€šä¿¡çš„ç¨‹åºã€‚
    - WebæœåŠ¡å™¨è½¯ä»¶é€šè¿‡æµè§ˆå™¨è½¯ä»¶è¿›è¡Œé€šä¿¡ã€‚
    - P2Pæ–‡ä»¶å…±äº«ç³»ç»Ÿï¼šå‚ä¸æ–‡ä»¶å…±äº«çš„ç¤¾åŒºä¸­çš„æ¯å°ä¸»æœºä¸­éƒ½æœ‰ä¸€ä¸ªç¨‹åºã€‚

- ä¸éœ€è¦ä¸“é—¨çš„è½¯ä»¶ä½œä¸ºç½‘ç»œæ ¸å¿ƒè®¾å¤‡ã€‚
    - ç½‘ç»œæ ¸å¿ƒè®¾å¤‡åœ¨åº”ç”¨å±‚ä¸Šå¹¶ä¸èµ·ä½œç”¨
    - è½¯ä»¶åº”ç”¨åœ¨ç«¯ç³»ç»Ÿä¸Šçš„è®¾è®¡æ–¹æ³•ï¼Œä¿ƒè¿›äº†ç½‘ç»œåº”ç”¨ç¨‹åºçš„è¿…é€Ÿç ”å‘å’Œéƒ¨ç½²ã€‚


### 1.3 ç½‘ç»œåº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„

æœ¯è¯­ï¼š**`åº”ç”¨ç¨‹åºä½“ç³»ç»“æ„ï¼ˆApplication Architectureï¼‰`** ã€‚

åº”ç”¨ç¨‹åºä½“ç³»ç»“æ„ç”±`åº”ç”¨ç¨‹åºç ”å‘è€…`è®¾è®¡ã€‚ä¸¤å¤§ä¸»æµçš„ä½“ç³»ç»“æ„

![](./img/ch02_img/åº”ç”¨ç¨‹åºçš„ä½“ç³»ç»“æ„.png)

P2Pä½“ç³»ç»“æ„æœ€å¤§çš„ç‰¹æ€§ï¼šè‡ªæ‰©å±•æ€§ã€‚P2Pä½“ç³»ç»“æ„ä¹Ÿæœ‰æˆæœ¬æœ‰æ•ˆï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸ä¸éœ€è¦åºå¤§çš„æœåŠ¡å™¨åŸºç¡€è®¾æ–½å’ŒæœåŠ¡å™¨å¸¦å®½ã€‚

ä½†P2Pä¹Ÿæœ‰ä¸‰å¤§æŒ‘æˆ˜
- ISPå‹å¥½é—®é¢˜
- ç”±äºé«˜åº¦åˆ†å¸ƒå’Œå¼€æ”¾ç‰¹æ€§ï¼Œæ‰€ä»¥å®‰å…¨æ€§å ªå¿§ã€‚
- ç”¨æˆ·éœ€è¦è‡ªå·±æœ‰ç½‘ç»œå¸¦å®½ã€å­˜å‚¨å’Œè®¡ç®—èµ„æºã€‚


### 1.4 è¿›ç¨‹é€šä¿¡

**`è¿›ç¨‹ï¼ˆprocessï¼‰------>  OSè§’åº¦`**ï¼šè¿è¡Œåœ¨ä¸»æœºï¼ˆç«¯ç³»ç»Ÿï¼‰ä¸­çš„ä¸€ä¸ªç¨‹åºã€‚

å½“è¿›ç¨‹è¿è¡Œåœ¨ç›¸åŒçš„ç«¯ç³»ç»Ÿä¸Šæ—¶ï¼Œæ‰€ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ç›¸äº’é€šä¿¡ã€‚

è¿›ç¨‹é—´é€šä¿¡çš„è§„åˆ™ï¼šç”± **`ç«¯ç³»ç»Ÿï¼ˆä¸»æœºï¼‰`** ä¸Šçš„OSç¡®å®šã€‚

è¿›ç¨‹åœ¨ä¸¤ä¸ªä¸åŒçš„ç«¯ç³»ç»Ÿï¼ˆä¸»æœºï¼‰ä¹‹é—´ï¼Œé€šè¿‡ **æŠ¥æ–‡ï¼ˆmessageï¼‰** è€Œç›¸äº’é€šä¿¡ã€‚

- å®¢æˆ·å’ŒæœåŠ¡å™¨è¿›ç¨‹

å°†ä¸€ä¸ªè¿›ç¨‹æ ‡è¯†ä¸º`å®¢æˆ·`ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹æ ‡è¯†ä¸º`æœåŠ¡å™¨`ï¼Œæ‰€ä»¥å®¢æˆ·å’ŒæœåŠ¡å™¨çš„å®šä¹‰å¦‚ä¸‹ï¼š
- **`å®¢æˆ·`**ï¼šå‘èµ·é€šä¿¡æ–¹ï¼ˆæµè§ˆå™¨ï¼‰----> è¿›ç¨‹é€šä¿¡åˆå§‹åŒ–
- **`æœåŠ¡å™¨`**ï¼šç­‰å¾…è”ç³»æ–¹ï¼ˆWebæœåŠ¡å™¨ï¼‰----> è¿›ç¨‹ç­‰å¾…è¢«è¿æ¥

å¦å¤–ï¼Œåœ¨åº”ç”¨å±‚çš„P2Pä½“ç³»ç»“æ„ä¸­ï¼Œä¹Ÿæœ‰å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ã€‚

- åˆ†å¸ƒå¼è¿›ç¨‹é€šä¿¡éœ€è¦è§£å†³çš„é—®é¢˜
    - é—®é¢˜1:è¿›ç¨‹æ ‡è¯†å’Œå¯»å€é—®é¢˜ï¼ˆæœåŠ¡ç”¨æˆ·ï¼‰
    - é—®é¢˜2:ä¼ è¾“å±‚-åº”ç”¨å±‚æä¾›æœåŠ¡å¦‚ä½•ï¼ˆæœåŠ¡ï¼‰
        - ä½ç½®ï¼šå±‚é—´ç•Œé¢çš„SAPï¼ˆTCP/IPï¼šsocketï¼‰
        - å½¢å¼ï¼šåº”ç”¨ç¨‹åºæ¥å£APIï¼ˆTCP/IPï¼šSocket APIï¼‰
    - é—®é¢˜3ï¼šå¦‚ä½•ä½¿ç”¨ä¼ è¾“å±‚æä¾›çš„æœåŠ¡ï¼Œå®ç°åº”ç”¨è¿›ç¨‹ä¹‹é—´çš„æŠ¥æ–‡äº¤æ¢ï¼Œå®ç°åº”ç”¨ï¼ˆç”¨æˆ·ä½¿ç”¨æœåŠ¡ï¼‰
        - å®šä¹‰åº”ç”¨å±‚åè®®ï¼š
        - ç¼–åˆ¶ç¨‹åºï¼Œä½¿ç”¨OSæä¾›çš„APIï¼Œè°ƒç”¨ç½‘ç»œåŸºç¡€è®¾æ–½æä¾›é€šä¿¡æœåŠ¡ä¼ æŠ¥æ–‡ï¼Œå®ç°åº”ç”¨æ—¶åºç­‰ã€‚


- Socketæ¥å£

    ![](./img/ch02_img/socketæ¥å£ç¤ºæ„å›¾.png)

    è¿›ç¨‹é€šè¿‡**å¥—æ¥å­—ï¼ˆsocketï¼‰** çš„è½¯ä»¶æ¥å£å‘ç½‘ç»œ`å‘é€`æŠ¥æ–‡å’Œä»ç½‘ç»œ`æ¥æ”¶`æŠ¥æ–‡ã€‚

    ä¾‹å­ï¼šè¿›ç¨‹ç±»ä¼¼äºæˆ¿å­ï¼Œå¥—æ¥å­—ç±»ä¼¼äºä¸€æ‰‡é—¨

    å‘é€è¿›ç¨‹éœ€è¦æ¨å¼€å¥—æ¥å­—è¿™ä¸ªé—¨ï¼Œå°±é€šè¿‡è¿è¾“è®¾å¤‡å°†æŠ¥æ–‡ä¼ é€åˆ°å…¶ä»–çš„ç›®çš„ä¸»æœºï¼Œæ¥æ”¶æ¥è‡ªä¼ é€’ç»™å¥—æ¥å­—çš„è¿›ç¨‹ã€‚

    - åº”ç”¨ç¨‹åºæ¥å£ï¼ˆApplication Programming Interfaceï¼ŒAPIï¼‰ï¼šåº”ç”¨ç¨‹åºä¸ç½‘ç»œä¹‹é—´çš„æ¥å£ã€‚

- è¿›ç¨‹å¯»å€è¿‡ç¨‹

    ä¸ºäº†æ¥æ”¶æŠ¥æ–‡ï¼Œè¿›ç¨‹å¿…é¡»æœ‰ä¸€ä¸ª`æ ‡è¯†ç¬¦`ã€‚

    è¯¥ç±»æ ‡è¯†ç¬¦å¿…é¡»æœ‰ä¸¤ç§ä¿¡æ¯ï¼š
    - ä¸»æœºçš„IPåœ°å€
    - ç«¯å£å·ï¼ˆport numbersï¼‰
        - ç«¯å£å·çš„ä¾‹å­ï¼šHTTPæœåŠ¡å™¨ï¼š80ã€é‚®ç®±æœåŠ¡å™¨ï¼š25
        - ä¾‹å­ï¼š192.168.245.12:80
    
    ä¸»æœºæœ‰`å”¯ä¸€çš„ï¼ˆuniqueï¼‰`32æ¯”ç‰¹çš„IPåœ°å€æ ‡è¯†ã€‚ä½¿ç”¨çš„ä¼ è¾“å±‚åè®®ï¼šTCPæˆ–è€…UDPã€‚

    - ä¸€ä¸ªè¿›ç¨‹ï¼šç”¨IP+port æ ‡ç¤ºç«¯èŠ‚ç‚¹
    - ä¸€å¯¹ä¸»æœºè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ç”±2ä¸ªç«¯èŠ‚ç‚¹æ„æˆã€‚


### 1.5 è°ƒç”¨åº”ç”¨ç¨‹åºéœ€è¦ä¼ è¾“å±‚ä¸Šçš„æœåŠ¡
ä¸»è¦ä»4ä¸ªæ–¹é¢è¿›è¡Œåˆ†ç±»ï¼š

![](./img/ch02_img/è°ƒç”¨åº”ç”¨ç¨‹åºéœ€è¦ä¼ è¾“å±‚ä¸Šçš„æœåŠ¡.png)

### 1.6 å› ç‰¹ç½‘æä¾›çš„ä¼ è¾“æœåŠ¡
![](./img/ch02_img/å› ç‰¹ç½‘æä¾›çš„ä¼ è¾“æœåŠ¡.png)

### 1.7 åº”ç”¨å±‚åè®®
åº”ç”¨å±‚åè®®å®šä¹‰äº†çš„å†…å®¹å¦‚ä¸‹ï¼š

- è¿è¡Œåœ¨ä¸åŒç«¯ç³»ç»Ÿä¸Šçš„åº”ç”¨è¿›ç¨‹å¦‚ä½•ç›¸äº’äº¤æ¢æŠ¥æ–‡
- äº¤æ¢çš„æŠ¥æ–‡ç±»å‹ï¼šè¯·æ±‚å’Œåº”ç­”æŠ¥æ–‡
- å„ç§æŠ¥æ–‡ç±»å‹çš„è¯­æ³•ï¼šæŠ¥æ–‡ä¸­çš„å„ä¸ªå­—æ®µåŠå…¶æè¿°
- å­—æ®µçš„è¯­ä¹‰ï¼šå³å­—æ®µå–å€¼çš„å«ä¹‰
- è¿›ç¨‹ä½•æ—¶ã€å¦‚ä½•å‘é€åŠå¯¹æŠ¥æ–‡è¿›è¡Œå“åº”çš„è§„åˆ™
- åº”ç”¨åè®®ä»…ä»…æ˜¯åº”ç”¨çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚
    - Webåº”ç”¨ï¼šHTTPåè®®ã€Webå®¢æˆ·ç«¯ã€WebæœåŠ¡å™¨ã€HTML

ä¸»è¦æœ‰ä¸¤ç§åè®®ç±»å‹ï¼š

- å…¬å¼€åè®®
    - ç”±RFCæ–‡æ¡£å®šä¹‰
    - å…è®¸äº’æ“ä½œ
    - å¦‚Webåº”ç”¨çš„HTTPã€ç”µå­é‚®ä»¶çš„SMTP
- ä¸“ç”¨ï¼ˆç§æœ‰ï¼‰åè®®
    - åè®®ä¸å…¬å¼€
    - å¦‚Skype

## 2. Webå’ŒHTTP
åœ¨RFCä¸­çš„å®šä¹‰ï¼ŒWebçš„åº”ç”¨å±‚åè®®ï¼šè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHyperText Transfer Protocolï¼ŒHTTPï¼‰ï¼Œä¹Ÿæ˜¯Webçš„æ ¸å¿ƒã€‚
- HTTP 1.0ï¼šRFC 1945
- HTTP 2.0ï¼šRFC 2068

### 2.1 HTTPæ¦‚è¿°
- ä¸€äº›åŸºæœ¬æœ¯è¯­ï¼š
    - Web Pageï¼šç”±ä¸€äº›å¯¹è±¡ç»„æˆã€‚
    - å¯¹è±¡å¯ä»¥æ˜¯HTMLæ–‡ä»¶ã€JPEGå›¾åƒã€Javaå°ç¨‹åºã€éŸ³è§†é¢‘æ–‡ä»¶ç­‰ã€‚
    - Webé¡µçš„ç”±åŒ…å«è‹¥ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼ˆé“¾æ¥ï¼‰çš„HTMLæ–‡ä»¶ç»„æˆã€‚
    - é€šè¿‡URLå¯¹æ¯ä¸ªå¯¹è±¡è¿›è¡Œå¼•ç”¨
        - è®¿é—®åè®®ï¼šç”¨æˆ·åã€å£ä»¤å­—ã€ç«¯å£ç­‰
    - URLåœ°å€æœ‰ä¸¤éƒ¨åˆ†ç»„æˆï¼š
        - å­˜æ”¾å¯¹è±¡çš„æœåŠ¡å™¨ä¸»æœºå
        - å¯¹è±¡çš„è·¯å¾„å
        - æ ¼å¼ï¼šwww.baidu.com/cat/cat.png

- HTTPç”±C/Sæ¨¡å¼å®ç°
    - å®¢æˆ·ï¼šè¯·æ±‚ã€æ¥æ”¶å’Œæ˜¾ç¤ºWebå¯¹è±¡çš„æµè§ˆå™¨
    - æœåŠ¡å™¨ï¼šå¯¹è¯·æ±‚è¿›è¡Œå“åº”ã€å‘é€å¯¹è±¡çš„WebæœåŠ¡å™¨

    ![](./img/ch02_img/HTTPä¸­CSæ¨¡å¼.png)

### 2.2 HTTPè¿æ¥
HTTPçš„è¿æ¥æ–¹å¼æœ‰ä¸¤ç§ï¼š
- éæŒç»­è¿æ¥ï¼ˆéæŒä¹…HTTPï¼‰
    - æ¯ä¸ªTCPè¿æ¥åªä¼ è¾“ä¸€ä¸ªè¯·æ±‚/å“åº”æŠ¥æ–‡ã€‚
    - ä¸‹è½½å¤šä¸ªå¯¹è±¡éœ€è¦å¤šä¸ªTCPè¿æ¥
    - HTTP/1.0 ä½¿ç”¨éæŒä¹…è¿æ¥
    - RTTï¼ˆRound-Trip Timeï¼‰ï¼šå¾€è¿”æ—¶é—´

    ![](./img/ch02_img/éæŒç»­HTTPè¿æ¥.png)

    - ç¼ºç‚¹ï¼š
        - å¿…é¡»ä¸ºæ¯ä¸ªè¯·æ±‚çš„å¯¹è±¡å»ºç«‹å’Œç»´æŠ¤ä¸€ä¸ªå…¨æ–°çš„è¿æ¥ã€‚å¯¹äºæ¯ä¸ªè¿™æ ·çš„è¿æ¥ï¼Œåœ¨å®¢æˆ·å’ŒæœåŠ¡å™¨ä¸­éƒ½è¦åˆ†é…TCPçš„ç¼“å†²åŒºå’Œä¿æŒTCPå˜é‡ï¼Œè¿™ä¼šç»™WebæœåŠ¡å™¨å¸¦æ¥ä¸¥é‡çš„è´Ÿæ‹…ã€‚
        - æ¯ä¸ªå¯¹è±¡ç»å—ä¸¤å€RTTçš„äº¤ä»˜æ—¶å»¶ã€‚
            - ä¸€ä¸ªRTTç”¨äºåˆ›å»ºTCP
            - å¦ä¸€ä¸ªRTTç”¨äºè¯·æ±‚å’Œæ¥æ”¶ä¸€ä¸ªå¯¹è±¡ï¼‰

- æŒç»­è¿æ¥ï¼ˆæŒä¹…HTTPï¼‰
    - å¤šä¸ªå¯¹è±¡å¯ä»¥åœ¨åŒä¸€ä¸ªï¼ˆåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ï¼‰TCPè¿æ¥ä¸Šä¼ è¾“ã€‚
    - æœåŠ¡å™¨åœ¨å‘é€å“åº”åï¼Œä»ä¿æŒTCPè¿æ¥ï¼Œå®¢æˆ·ç«¯é‡åˆ°é‡åˆ°ä¸€ä¸ªå¼•ç”¨å¯¹è±¡æ—¶ï¼Œåˆ™å¯ä»¥ç›´æ¥å‘é€è¯¥å¯¹è±¡çš„è¯·æ±‚ã€‚
    - HTTP/1.1 é»˜è®¤ä½¿ç”¨å¸¦æµæ°´çº¿çš„æŒç»­è¿æ¥ã€‚
    - å¦‚æœä¸€æ¡è¿æ¥ç»è¿‡ä¸€å®šæ—¶é—´é—´éš”ä»æœªè¢«ä½¿ç”¨ï¼ŒHTTPæœåŠ¡å™¨åˆ™ä¼šç›´æ¥å…³é—­è¯¥è¿æ¥ã€‚
    - æµæ°´çº¿æ–¹å¼çš„æŒä¹…HTTP
        - å®¢æˆ·ç«¯åªèƒ½åœ¨æ”¶åˆ°è¯·ä¸€ä¸ªå“åº”åæ‰èƒ½å‘å‡ºæ–°çš„è¯·æ±‚
        - æ¯ä¸ªå¼•ç”¨å¯¹è±¡èŠ±è´¹ä¸€ä¸ªRTTã€‚
    - æµæ°´æ–¹å¼çš„æŒä¹…HTTP
        - HTTP/1.1 çš„é»˜è®¤æ–¹å¼
        - å®¢æˆ·ç«¯é‡åˆ°ä¸€ä¸ªå¼•ç”¨å¯¹è±¡å°±ç«‹å³äº§ç”Ÿä¸€ä¸ªè¯·æ±‚
        - æ‰€æœ‰å¼•ç”¨å¯¹è±¡åªèŠ±è´¹ä¸€ä¸ªRTTæ˜¯å¯èƒ½çš„ã€‚

### 2.3 HTTPæŠ¥æ–‡æ ¼å¼
HTTPçš„æŠ¥æ–‡æœ‰ä¸¤ç§ï¼š
- è¯·æ±‚æŠ¥æ–‡

    ![](./img/ch02_img/HTTPè¯·æ±‚æŠ¥æ–‡.png)

- å“åº”æŠ¥æ–‡

    ![](./img/ch02_img/HTTPå“åº”æŠ¥æ–‡.png)

### 2.4 C/Sçš„äº¤äº’:cookie
åœ¨ RFC 6265 ä¸­ï¼ŒHTTPä½¿ç”¨cookieï¼Œå…è®¸ç«™ç‚¹å¯¹è¿›è¡Œè·Ÿè¸ªã€‚å¤§å¤šæ•°çš„Webç«™ç‚¹éƒ½ä½¿ç”¨cookieã€‚

cookieæŠ€æœ¯æœ‰4ä¸ªç»„ä»¶ï¼š
- åœ¨HTTPå“åº”æŠ¥æ–‡ä¸­çš„ä¸€ä¸ªcookieé¦–éƒ¨è¡Œ
- åœ¨HTTPè¯·æ±‚æŠ¥æ–‡ä¸­çš„ä¸€ä¸ªcookieé¦–éƒ¨è¡Œ
- åœ¨ç”¨æˆ·ç«¯ç³»ç»Ÿä¸­ä¿ç•™æœ‰ä¸€ä¸ªcookieæ–‡ä»¶ï¼Œç”±ç”¨æˆ·çš„æµè§ˆå™¨è¿›è¡Œç®¡ç†ã€‚
- ä½äºWebç«™ç‚¹çš„ä¸€ä¸ªåç«¯æ•°æ®åº“ã€‚

![](./img/ch02_img/C-Säº¤äº’cookie.png)

cookieå¯ç”¨äºæ ‡è¯†ä¸€ä¸ªç”¨æˆ·ã€‚ç”¨æˆ·é¦–æ¬¡è®¿é—®ä¸€ä¸ªç«™ç‚¹æ—¶ï¼Œå¯èƒ½éœ€è¦æä¾›ä¸€ä¸ªç”¨æˆ·æ ‡è¯†ï¼ˆå¯èƒ½æ˜¯åå­—ï¼‰ã€‚å› æ­¤cookieå¯ä»¥åœ¨æ— çŠ¶æ€çš„HTTPä¹‹ä¸Šå»ºç«‹ä¸€ä¸ªç”¨æˆ·ä¼šè¯å±‚æ¬¡ã€‚æ‰€ä»¥å¯ä»¥å®ç°åŠ¨æ€é’ˆå¯¹ä¸åŒç”¨æˆ·æ˜¾ç¤ºä¸åŒçš„å†…å®¹ã€‚

### 2.5 Webç¼“å­˜ï¼ˆä»£ç†æœåŠ¡å™¨ï¼‰
Webç¼“å­˜æœ‰è‡ªå·±çš„ç£ç›˜å­˜å‚¨ç©ºé—´ï¼Œå­˜å‚¨ç©ºé—´ä¸­ä¿å­˜æœ€è¿‘è¯·æ±‚è¿‡çš„å¯¹è±¡çš„å‰¯æœ¬ã€‚

![](./img/ch02_img/webç¼“å­˜.png)

åœ¨å› ç‰¹ç½‘ä¸Šéƒ¨ç½²Webç¼“å­˜å™¨æœ‰ä¸¤ä¸ªåŸå› ï¼š
- Webç¼“å­˜å™¨å¯ä»¥å¤§å¤§å‡å°‘å¯¹å®¢æˆ·è¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯å½“å®¢æˆ·ä¸åˆå§‹æœåŠ¡å™¨ä¹‹é—´çš„ç“¶é¢ˆå¸¦å®½è¿œä½äºå®¢æˆ·ä¸Webç¼“å­˜å™¨ä¹‹é—´çš„ç“¶é¢ˆå¸¦å®½æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ã€‚
- Webç¼“å­˜å™¨èƒ½å¤§å¤§å‡å°‘ä¸€ä¸ªæœºæ„çš„æ¥å…¥é“¾è·¯åˆ°å› ç‰¹ç½‘çš„é€šä¿¡é‡ã€‚

### 2.6 æ¡ä»¶GETæ–¹æ³•
HTTPåè®®æœ‰ä¸€ç§æœºåˆ¶ï¼Œå…è®¸ç¼“å­˜å™¨è¯å®å®ƒçš„å¯¹è±¡æ˜¯æœ€æ–°çš„ï¼Œè¿™ç§æœºåˆ¶å«åšæ¡ä»¶GETæ–¹æ³•ã€‚
- è¯·æ±‚æŠ¥æ–‡ä½¿ç”¨GETæ–¹æ³•
- è¯·æ±‚æŠ¥æ–‡ä¸­åŒ…å«ä¸€ä¸ª â€œIf-Modified-Sinceâ€ï¼šé¦–éƒ¨è¡Œ

åˆ™HTTPè¯·æ±‚æŠ¥æ–‡å°±æ˜¯ä¸€ä¸ªæ¡ä»¶GETè¯·æ±‚æŠ¥æ–‡ã€‚

![](./img/ch02_img/æ¡ä»¶GETæ–¹æ³•.png)

## 3. æ–‡ä»¶ä¼ è¾“åè®®ï¼šFTP

### 3.1 FTPæ¦‚è¿°
FTPåè®®åœ¨æœ¬åœ°ä¸è¿œç¨‹æ–‡ä»¶ä¹‹é—´çš„æ–‡ä»¶ä¼ è¾“ç¤ºæ„å›¾ï¼š

![](./img/ch02_img/FTPä¼ è¾“ç¤ºæ„å›¾.png)

- ç”¨æˆ·ååœ¨ä¸€å°ä¸»æœºï¼ˆæœ¬åœ°ä¸»æœºï¼‰å‰é¢ï¼Œå‘ä¸€å°è¿œç¨‹ä¸»æœºä¼ è¾“ï¼ˆæˆ–æ¥æ”¶æ¥è‡ªè¿œç¨‹ä¸»æœºçš„ï¼‰æ–‡ä»¶ã€‚
- C/Sæ¨¡å¼
    - å®¢æˆ·ç«¯ï¼šå‘èµ·ä¼ è¾“çš„ä¸€æ–¹
    - æœåŠ¡å™¨ï¼šè¿œç¨‹ä¸»æœº
- FTPï¼šRFC 959
- FTPæœåŠ¡å™¨ï¼šç«¯å£å·ä¸º21

HTTPå’ŒFTPéƒ½æ˜¯æ–‡ä»¶ä¼ è¾“åè®®ã€‚
- å…±åŒç‰¹ç‚¹ï¼šéƒ½è¿è¡Œåœ¨TCPä¸Šã€‚
- ä¸åŒç‚¹ï¼šFTPä½¿ç”¨ä¸¤ä¸ªå¹¶è¡Œçš„TCPè¿æ¥ä¼ è¾“æ–‡ä»¶ã€‚
    - æ§åˆ¶è¿æ¥ï¼šç”¨äºåœ¨ä¸¤ä¸»æœºä¹‹é—´ä¼ è¾“æ§åˆ¶ä¿¡æ¯ã€‚
    - æ•°æ®è¿æ¥ï¼šç”¨äºå®é™…å‘é€ä¸€ä¸ªæ–‡ä»¶ã€‚

å› æ­¤ï¼ŒFTPçš„æ§åˆ¶ä¿¡æ¯æ˜¯å¸¦å¤–ï¼ˆout-of-bandï¼‰ä¼ é€çš„ï¼ŒHTTPå¯ä»¥è¯´æ˜¯å¸¦å†…ï¼ˆin-bandï¼‰å‘é€æ§åˆ¶ä¿¡æ¯çš„

æ§åˆ¶ä¿¡æ¯æ˜¯æŒç»­çš„ï¼Œè€Œæ•°æ®è¿æ¥æ˜¯éæŒç»­çš„ï¼Œå¯¹ä¼šè¯ä¸­çš„æ¯ä¸€æ¬¡æ–‡ä»¶ä¼ è¾“éƒ½éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„æ•°æ®è¿æ¥ï¼Œç›´åˆ°ä¼ è¾“å®Œæ¯•åå…³é—­ä¼šè¯ã€‚

### 3.2 FTPå‘½ä»¤å’Œå›ç­”
ä»å®¢æˆ·åˆ°æœåŠ¡å™¨çš„å‘½ä»¤å’Œä»æœåŠ¡å™¨åˆ°å®¢æˆ·çš„å›ç­”ï¼Œéƒ½æ˜¯ä»¥ `7æ¯”ç‰¹` ASCIIæ ¼å¼åœ¨æ§åˆ¶è¿æ¥ä¸Šä¼ é€çš„ã€‚
> æ¯ä¸ªå‘½ä»¤åè·Ÿå›è½¦æ¢è¡Œç¬¦ï¼Œéƒ½æ˜¯ç”±`4ä¸ªå¤§å†™å­—æ¯ASCIIå­—ç¬¦`ç»„æˆã€‚

ä¸€äº›å¸¸è§çš„å‘½ä»¤ï¼š
- `USER username`ï¼šç”¨äºæœåŠ¡å™¨ä¼ é€ç”¨æˆ·æ ‡è¯†
- `PASS password`ï¼šç”¨äºæœåŠ¡å™¨å‘é€ç”¨æˆ·å£ä»¤
- `LIST`ï¼šç”¨äºè¯·æ±‚æœåŠ¡å™¨å›é€å½“å‰è¿œç¨‹ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶åˆ—è¡¨ã€‚
    - é€šè¿‡æ•°æ®ä¼ é€æ–¹å¼ï¼Œè€Œä¸æ˜¯åœ¨æ§åˆ¶TCPè¿æ¥ä¸Šä¼ é€
- `RETR filename`ï¼šç”¨äºä»è¿œç¨‹ä¸»æœºçš„å½“å‰ç›®å½•æ£€ç´¢ï¼ˆå³getï¼‰æ–‡ä»¶
    - è®©è¿œç¨‹ä¸»æœºå‘èµ·æ•°æ®è¿æ¥ï¼Œå¹¶ç»è¿‡æ•°æ®è¿æ¥å‘é€æ‰€è¯·æ±‚çš„æ–‡ä»¶
- `STOR filename`ï¼šç”¨äºä»è¿œç¨‹ä¸»æœºçš„å½“å‰ç›®å½•å­˜æ”¾ï¼ˆå³putï¼‰æ–‡ä»¶

å¸¸è§çš„å“åº”å’Œå¯èƒ½çš„æŠ¥æ–‡
- `311 Username OKï¼ŒPassword required`ï¼šç”¨æˆ·åOKï¼Œéœ€è¦å£ä»¤
- `125 Data connection already open;transfer starting`ï¼šæ•°æ®è¿æ¥å·²æ‰“å¼€ï¼Œå¼€å§‹ä¼ é€
- `425 Can't open data connection`ï¼šæ— æ³•æ‰“å¼€æ•°æ®è¿æ¥
- `452 Error writing file`ï¼šå†™æ–‡ä»¶å·®é”™

## 4. å› ç‰¹ç½‘ä¸­çš„ç”µå­é‚®ä»¶
ç”µå­é‚®ä»¶æ˜¯ä¸€ç§å¼‚æ­¥é€šä¿¡åª’ä»‹ã€‚

å› ç‰¹ç½‘ç”µå­é‚®ä»¶ç³»ç»Ÿï¼Œä¸»è¦æœ‰ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š
- ç”¨æˆ·ä»£ç†ï¼ˆuser agentï¼‰
- é‚®ä»¶æœåŠ¡å™¨ï¼ˆmail serverï¼‰
- ç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼ˆSimple Mail Transfer Protocolï¼ŒSMTPï¼‰

![](./img/ch02_img/ç”µå­é‚®ä»¶çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†.png)

SMTPæ˜¯å› ç‰¹ç½‘ç”µå­é‚®ä»¶ä¸­ä¸»è¦çš„åº”ç”¨å±‚åè®®ã€‚

### 4.1 SMTP
SMTPä¸€èˆ¬ä¸ä½¿ç”¨ä¸­é—´é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶ã€‚

- ä½¿ç”¨TCPåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ é€æŠ¥æ–‡ï¼Œç«¯å£ä¸º25.
- ç›´æ¥ä¼ è¾“
    - ä½¿ç”¨TCPå¯é æ•°æ®ä¼ è¾“æœåŠ¡ï¼Œä»å‘é€æ–¹çš„é‚®ä»¶æœåŠ¡å™¨å‘æ¥æ”¶æ–¹çš„é‚®ä»¶æœåŠ¡å™¨å‘é€é‚®ä»¶ã€‚
- ä¼ è¾“çš„3ä¸ªé˜¶æ®µ
    - æ¡æ‰‹
    - ä¼ è¾“æŠ¥æ–‡
    - å…³é—­
- å‘½ä»¤/å“åº”äº¤äº’
    - å‘½ä»¤ï¼šASCIIæ–‡æœ¬
    - å“åº”ï¼šçŠ¶æ€ç å’ŒçŠ¶æ€ä¿¡æ¯

- æŠ¥æ–‡å¿…é¡»ä¸º 7ä½ ASCIIç ã€‚


### 4.2 ä¸HTTPçš„æ¯”è¾ƒ
- åŒºåˆ«1
    - HTTPï¼šæ‹‰ï¼ˆpullï¼‰åè®®
    - SMTPï¼šæ¨ï¼ˆpushï¼‰åè®®
    - äºŒè€…éƒ½æ˜¯ASCIIå½¢å¼çš„å‘½ä»¤/å“åº”äº¤äº’ã€çŠ¶æ€ç 
- åŒºåˆ«2
    - SMTPä½¿ç”¨æŒç»­è¿æ¥
    - SMTPè¦æ±‚æŠ¥æ–‡ï¼ˆé¦–éƒ¨å’Œä¸»ä½“ï¼‰ä¸º7ä½ASCIIç¼–ç 
    - SMTPæœåŠ¡å™¨ä½¿ç”¨CRLFï¼ŒCRLFå†³å®šæŠ¥æ–‡çš„å°¾éƒ¨
- åŒºåˆ«3
    - å¦‚ä½•å¤„ç†åŒ…å«æ–‡æœ¬å’Œå›¾åƒçš„æ–‡æ¡£çš„åŒºåˆ«ã€‚
    - HTTPï¼šæ¯ä¸ªå¯¹è±¡å°è£…åœ¨å„è‡ªçš„å“åº”æŠ¥æ–‡ä¸­ã€‚
    - SMTPï¼šå¤šä¸ªå¯¹è±¡åŒ…å«åœ¨ä¸€ä¸ªæŠ¥æ–‡ä¸­ã€‚

### 4.3 é‚®ä»¶æŠ¥æ–‡æ ¼å¼

![](./img/ch02_img/é‚®ä»¶æŠ¥æ–‡æ ¼å¼.png)

### 4.4 é‚®ä»¶è®¿é—®åè®®
ç”±äºSMTPæ˜¯æ¨æ“ä½œï¼Œä½†ç”¨æˆ·æŸ¥çœ‹é‚®ä»¶åˆ™æ˜¯æ‹‰æ“ä½œï¼Œæ‰€ä»¥å¼•å…¥ç‰¹æ®Šçš„åè®®æ¥å¤„ç†é—®é¢˜ã€‚å¸¸è§çš„é‚®ä»¶è®¿é—®åè®®ï¼š
- ç¬¬ä¸‰ç‰ˆçš„é‚®å±€åè®®ï¼ˆPost Office Protocol- Versionï¼ŒPOP3ï¼‰ã€RFC 1939ã€‘
    - ç”¨æˆ·èº«ä»½ç¡®è®¤ï¼ˆä»£ç† <------> æœåŠ¡å™¨ï¼‰å¹¶ä¸‹è½½
    - æŒ‰ç…§3ä¸ªé˜¶æ®µè¿›è¡Œï¼š
        - ç‰¹è®¸ï¼ˆauthorizationï¼‰ï¼šç”¨æˆ·ä»£ç†å‘é€ï¼ˆä»¥æ˜æ–‡å½¢å¼ï¼‰ç”¨æˆ·åå’Œå£ä»¤ä»¥é‰´åˆ«ç”¨æˆ·ã€‚
            - å®¢æˆ·ç«¯å‘½ä»¤ï¼š
                - userï¼šå£°æ˜ç”¨æˆ·å
                - passï¼šå£ä»¤
            - æœåŠ¡å™¨å“åº”
                - +OK
                - -ERR

        - äº‹åŠ¡å¤„ç†ï¼šç”¨æˆ·ä»£ç†å–å›æŠ¥æ–‡æˆ–è€…å…¶ä»–æ“ä½œï¼ˆåˆ é™¤æŠ¥æ–‡æ ‡è®°ç­‰ï¼‰
            - listï¼šæŠ¥æ–‡å·åˆ—è¡¨
            - retrï¼šæ ¹æ®æŠ¥æ–‡å·æ£€ç´¢æŠ¥æ–‡
            - deleï¼šåˆ é™¤
            - quit
        - æ›´æ–°ï¼šå‘å‡ºquitå‘½ä»¤åï¼Œç›®çš„ï¼šç»“æŸPOP3ä¼šè¯ã€‚

- å› ç‰¹ç½‘é‚®ä»¶è®¿é—®åè®®ï¼ˆInternet Mail Access Protocolï¼ŒIMAPï¼‰ã€RFC 1730ã€‘
    - æ›´å¤šç‰¹æ€§ï¼Œæ›´å¤æ‚
- HTTPï¼šåŸºäºWebçš„ç”µå­é‚®ä»¶ã€‚
    - ç”¨æˆ·ä»£ç†å³æ˜¯æ™®é€šçš„æµè§ˆå™¨ï¼Œç”¨æˆ·å’Œè¿œç¨‹é‚®ä»¶ä¹‹é—´çš„é€šä¿¡éƒ½æ˜¯é€šè¿‡HTTPè¿›è¡Œã€‚

![](./img/ch02_img/é‚®ä»¶è®¿é—®åè®®.png)

## 5. DNSï¼šå› ç‰¹ç½‘çš„ç›®å½•æœåŠ¡
- è¯†åˆ«ä¸»æœºçš„ä¸¤ç§æ–¹å¼ï¼š
    - ä¸»æœºå
    - IPåœ°å€

ä¸€ä¸ªIPåœ°å€ç”± 4ä¸ªï¼ˆ32 bitï¼‰å­—èŠ‚ ç»„æˆï¼Œå¹¶æœ‰ä¸¥æ ¼çš„å±‚æ¬¡ç»“æ„ã€‚

### 5.1 DNSæä¾›çš„æœåŠ¡
- DNSï¼ˆDomain Name Systemï¼‰ï¼šåŸŸåç³»ç»Ÿ
    - åˆ†å¸ƒå¼æ•°æ®åº“ï¼šåˆ†å±‚çš„DNSæœåŠ¡å™¨å®ç°
    - åº”ç”¨å±‚åè®®ï¼šä¸»æœºèƒ½å¤ŸæŸ¥è¯¢åˆ†å¸ƒå¼æ•°æ®åº“çš„åº”ç”¨å±‚åè®®ã€‚
    - DNSæœåŠ¡å™¨é€šå¸¸æ˜¯è¿è¡ŒBINDè½¯ä»¶çš„UNIXæœºå™¨ã€‚
    - DNSåè®®è¿è¡Œåœ¨UDPä¸Šï¼Œç«¯å£å·ï¼š53

DNSé€šå¸¸æ˜¯ç”±å…¶ä»–åº”ç”¨åè®®æ‰€ä½¿ç”¨çš„ï¼ŒåŒ…æ‹¬HTTPã€SMTPå’ŒFTPï¼Œå°†ç”¨æˆ·æä¾›çš„ä¸»æœºåè§£æä¸ºIPåœ°å€ã€‚

- ğŸš© ğŸš©å½“æµè§ˆå™¨ä¸­è¯·æ±‚ä¸€ä¸ªURLæ—¶ï¼Œå…·ä½“çš„æ“ä½œå¦‚ä¸‹ï¼š
    - åŒä¸€å°ç”¨æˆ·åœ¨ä¸»æœºä¸Šè¿è¡Œç€DNSåº”ç”¨çš„å®¢æˆ·ç«¯
    - æµè§ˆå™¨ä»URLä¸­æŠ½å–å‡ºä¸»æœºåï¼Œç„¶åå°†ä¸»æœºåä¼ ç»™DNSåº”ç”¨çš„å®¢æˆ·ç«¯
    - DNSå®¢æˆ·å‘DNSæœåŠ¡å™¨å‘é€ä¸€ä¸ªåŒ…å«ä¸»æœºåçš„è¯·æ±‚
    - DNSå®¢æˆ·ä¼šæ”¶åˆ°ä¸€ä¸ªå“åº”æŠ¥æ–‡ï¼Œå…¶ä¸­åŒ…å«å¯¹åº”ä¸»æœºåçš„IPåœ°å€ã€‚
    - æµè§ˆå™¨æ”¶åˆ°æ¥è‡ªDNSçš„IPåœ°å€ï¼Œèƒ½å¤Ÿå‘ä½äºè¯¥IPåœ°å€80ç«¯å£çš„HTTPæœåŠ¡å™¨è¿›ç¨‹å‘èµ·ä¸€ä¸ªTCPè¿æ¥ã€‚

- DNSæä¾›çš„æœåŠ¡ï¼š
    - ä¸»æœºååˆ°IPåœ°å€çš„è½¬æ¢
    - ä¸»æœºåˆ«åï¼ˆhost aliasingï¼‰
        - å¤æ‚ä¸»æœºåçš„ä¸»æœºèƒ½æ‹¥æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ«åã€‚
    - é‚®ä»¶æœåŠ¡å™¨åˆ«åï¼ˆmail server aliasingï¼‰
        - 
    - è´Ÿè½½åˆ†é…ï¼ˆload distributionï¼‰
        - DNSä¹Ÿç”¨äºåœ¨å†—ä½™çš„æœåŠ¡å™¨ä¹‹é—´è´Ÿè½½åˆ†é…ã€‚
- åŸŸåçš„ç®¡ç†
    - ä¸€ä¸ªåŸŸç®¡ç†å…¶ä¸‹çš„å­åŸŸ
        - å¦‚ï¼š.cn è¢«åˆ’åˆ†ä¸º edu.cnã€.com.cn
    - åˆ›å»ºä¸€ä¸ªæ–°çš„åŸŸï¼Œå¿…é¡»å¾å¾—å…¶æ‰€å±åŸŸçš„åŒæ„ã€‚
- åŸŸå’Œç‰©ç†ç½‘ç»œæ— å…³
    - åŸŸéµä»ç»„ç»‡ç•Œé™ï¼Œè€Œä¸æ˜¯ç‰©ç†ç½‘ç»œ
        - ä¸€ä¸ªåŸŸçš„ä¸»æœºä¸åœ¨ä¸€ä¸ªç½‘ç»œ
        - ä¸€ä¸ªç½‘ç»œçš„ä¸»æœºä¸ä¸€å®šåœ¨ä¸€ä¸ªåŸŸ
    - åŸŸçš„åˆ’åˆ†æ˜¯é€»è¾‘çš„ï¼Œè€Œä¸æ˜¯ç‰©ç†çš„ã€‚


### 5.2 DNSå·¥ä½œè¿‡ç¨‹æ¦‚è¿°
DNSçš„ä¸€ç§ç®€å•è®¾è®¡æ˜¯åœ¨å› ç‰¹ç½‘ä¸Šåªä½¿ç”¨ä¸€ä¸ªDNSæœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨åŒ…å«æ‰€æœ‰çš„æ˜ å°„ã€‚

- é›†ä¸­å¼è®¾è®¡å­˜åœ¨çš„é—®é¢˜
    - å•ç‚¹æ•…éšœï¼ˆå¯é æ€§é—®é¢˜ï¼‰
    - é€šä¿¡å®¹é‡ï¼ˆæ‰©å±•æ€§é—®é¢˜ï¼‰
    - è¿œè·ç¦»çš„é›†ä¸­å¼æ•°æ®åº“ï¼ˆç»´æŠ¤æ€§é—®é¢˜ï¼‰
    - ç»´æŠ¤

- ä¸‰ç§å¸¸è§çš„DNSæœåŠ¡å™¨ç±»å‹ï¼š

    ![](./img/ch02_img/DNSæœåŠ¡å™¨çš„ç±»å‹.png)

    æ ¹ã€TLDå’Œæƒå¨DNSæœåŠ¡å™¨éƒ½å¤„åœ¨è¯¥DNSæœåŠ¡å™¨çš„å±‚æ¬¡ç»“æ„ä¸­ã€‚

- æœ¬åœ°DNSæœåŠ¡å™¨ï¼ˆlocal DNS Serverï¼‰
    - ä¸¥æ ¼æ¥è¯´ä¸å±äºè¯¥æœåŠ¡å™¨çš„å±‚æ¬¡ç»“æ„ã€‚
    - æ¯ä¸ªISPï¼ˆå¦‚ä¸€ä¸ªå¤§å­¦ã€ä¸€ä¸ªç³»ã€ä¸€ä¸ªå…¬å¸æˆ–è€…ä¸€ä¸ªå±…æ°‘åŒºçš„ISPï¼‰éƒ½æœ‰ä¸€å°æœ¬åœ°DNSæœåŠ¡å™¨ã€‚
        - ä¹Ÿå«åšé»˜è®¤åå­—æœåŠ¡å™¨
    - å½“ä¸»æœºå‘å‡ºDNSè¯·æ±‚æ—¶ï¼Œè¯¥è¯·æ±‚è¢«å‘å¾€æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œèµ·åˆ°ä»£ç†ä½œç”¨ï¼Œç„¶åå°†è¯¥è¯·æ±‚è½¬å‘åˆ°DNSæœåŠ¡å™¨å±‚æ¬¡ç»“æ„ä¸­ã€‚

- DNSç¼“å­˜
    - ä¸ºäº†æ”¹å–„æ—¶å»¶æ€§èƒ½å¹¶å‡å°‘åœ¨å› ç‰¹ç½‘ä¸Šåˆ°å¤„ä¼ è¾“çš„DNSæŠ¥æ–‡æ•°é‡ï¼Œæ‰€ä»¥DNSå¹¿æ³›ä½¿ç”¨ç¼“å­˜æŠ€æœ¯ã€‚
    - ä¸€æ—¦ä¸»æœºæ”¶åˆ°DNSå“åº”ï¼Œåˆ™ä¼šç›´æ¥å°†å“åº”ä¸­åŒ…å«çš„ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸­ã€‚
    - ä¸»æœºå’Œä¸»æœºåä¸IPåœ°å€é—´çš„æ˜ å°„éæ°¸ä¹…ï¼ŒDNSæœåŠ¡å™¨ä¼šåœ¨ä¸€æ®µæ—¶é—´åä¸¢å¼ƒç¼“å­˜çš„ä¿¡æ¯ã€‚
        - å› ç¼“å­˜ï¼Œæœ¬åœ°DNSæœåŠ¡å™¨å¯ä»¥ç«‹å³è¿”å›ä¸»æœºåçš„IPåœ°å€ï¼Œè€Œä¸å¿…æŸ¥è¯¢å…¶ä»–ä»»ä½•DNSæœåŠ¡å™¨ã€‚
        - æœ¬åœ°DNSæœåŠ¡å™¨èƒ½ç¼“å­˜TLDæœåŠ¡å™¨çš„IPåœ°å€ï¼Œå› è€Œå…è®¸æœ¬åœ°DNSç»•è¿‡æŸ¥è¯¢é“¾ä¸­çš„æ ¹DNSæœåŠ¡å™¨ã€‚

### 5.3 DNSè®°å½•å’ŒæŠ¥æ–‡
å…±åŒå®ç°DNSåˆ†å¸ƒå¼æ•°æ®åº“çš„æ‰€æœ‰DNSæœåŠ¡å™¨å­˜å‚¨äº† **èµ„æºè®°å½•ï¼ˆResource Recordï¼ŒRRï¼‰** ï¼ŒRRæ ¹æ®ä¸»æœºååˆ°IPåœ°å€çš„æ˜ å°„ã€‚æ¯ä¸ªDNSå“åº”æŠ¥æ–‡åŒ…å«äº†ä¸€æ¡æˆ–è€…å¤šæ¡èµ„æºè®°å½•ã€‚

- èµ„æºè®°å½•åŒ…å«çš„å­—æ®µ

    ![](./img/ch02_img/èµ„æºè®°å½•.png)

- DNSæŠ¥æ–‡
    - DNSçš„æŸ¥è¯¢å’Œå“åº”æŠ¥æ–‡çš„æ ¼å¼ç›¸åŒã€‚

    ![](./img/ch02_img/DNSæŠ¥æ–‡æ ¼å¼.png)

    - nslookupç¨‹åº
        - å¯ä»¥ä»æ­£åœ¨å·¥ä½œçš„ä¸»æœºç›´æ¥å‘æŸäº›DNSæœåŠ¡å™¨å‘é€ä¸€ä¸ªDNSæŸ¥è¯¢æŠ¥æ–‡ã€‚
        - åç»­å®éªŒåè¡¥å……

- åœ¨DNSæ•°æ®åº“ä¸­æ’å…¥è®°å½•
    - æ³¨å†Œç™»è®°æœºæ„ï¼ˆregisterï¼‰ï¼šå•†ä¸šå®ä½“
        - éªŒè¯åŸŸåçš„å”¯ä¸€æ€§ï¼Œå°†è¯¥åŸŸåè¾“å…¥DNSæ•°æ®åº“ï¼Œå¯¹æä¾›çš„æœåŠ¡æ”¶å–å°‘é‡è´¹ç”¨ã€‚

- DNSè„†å¼±æ€§
    - DNSæ˜¯ä¸€ä¸ªæ˜“å—æ”»å‡»çš„ç›®æ ‡ï¼Œä¸»è¦æ”»å‡»ç­–ç•¥ï¼š
        - åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ï¼ˆDDoSï¼‰å¸¦å®½æ´ªæ³›æ”»å‡»
        - é‡å®šå‘æ”»å‡»
        - åˆ©ç”¨DNSåŸºç¡€è®¾æ–½å¯¹ç›®æ ‡ä¸»æœºè¿›è¡ŒDDoSæ”»å‡»

## 6. P2Påº”ç”¨
C/Sæ¶æ„ä¾èµ–äºæ€»æ˜¯æ‰“å¼€çš„åŸºç¡€è®¾æ–½æœåŠ¡ï¼Œè€ŒP2Pä¾èµ–è¾ƒå°ã€‚

P2Pæˆå¯¹é—´æ­‡æ€§è¿æ¥çš„ä¸»æœºï¼ˆç§°ä¸ºå¯¹ç­‰æ–¹ï¼‰å½¼æ­¤ç›´æ¥é€šä¿¡ã€‚

- P2Pè®¾è®¡çš„åº”ç”¨
    - ä»å•ä¸€æœåŠ¡å™¨å‘å¤§é‡ä¸»æœºï¼ˆç§°ä¸ºå¯¹ç­‰æ–¹ï¼‰åˆ†å‘ä¸€ä¸ªå¤§æ–‡ä»¶
    - æ–‡ä»¶åˆ†å‘
    - åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆåˆ†å¸ƒå¼æ•£åˆ—è¡¨çš„æ¦‚å¿µï¼ŒDistributed Hash Tableï¼ŒDHTï¼‰

### 6.1 çº¯P2Pæ¶æ„
- æ²¡æœ‰ï¼ˆæˆ–æå°‘ï¼‰ä¸€ç›´è¿è¡Œçš„æœåŠ¡å™¨
- ä»»æ„ç«¯ç³»ç»Ÿéƒ½å¯ä»¥ç›´æ¥é€šä¿¡
- åˆ©ç”¨peerçš„æœåŠ¡èƒ½åŠ›
- PeerèŠ‚ç‚¹é—´æ­‡æ€§ä¸Šç½‘ï¼Œæ¯æ¬¡IPåœ°å€éƒ½æœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚
- å¸¸è§çš„ä¾‹å­ï¼š
    - æ–‡ä»¶åˆ†å‘
    - æµåª’ä½“
    - VoIPï¼ˆSkypeï¼‰

### 6.2 æ–‡ä»¶åˆ†å‘ç³»ç»Ÿ
- P2Pæ¶æ„çš„æ‰©å±•æ€§
    - åˆ†å‘æ—¶é—´ï¼ˆDistributed timeï¼‰ï¼šæ‰€æœ‰Nä¸ªå¯¹ç­‰æ–¹å¾—åˆ°è¯¥æ–‡ä»¶çš„å‰¯æœ¬æ‰€éœ€è¦çš„æ—¶é—´ã€‚

    ![](./img/ch02_img/DNSæŠ¥æ–‡æ ¼å¼.png)

- BitTorrent
    - P2Pæ–‡ä»¶å…±äº«åè®®çš„ç»å…¸åº”ç”¨ã€‚
    - æ‰€æœ‰çš„å¯¹ç­‰æ–¹éƒ½æ˜¯æœåŠ¡å™¨ã€‚
    - P2Pæ–‡ä»¶å…±äº«è¦è§£å†³çš„ä¸¤å¤§é—®é¢˜
        - å¦‚ä½•å®šä½æ‰€éœ€èµ„æº
        - å¦‚ä½•å¤„ç†å¯¹ç­‰æ–¹çš„åŠ å…¥å’Œç¦»å¼€
    - è§£å†³é—®é¢˜å¯èƒ½çš„æ–¹æ¡ˆ
        - é›†ä¸­
        - åˆ†å¸ƒå¼
        - åŠåˆ†æ•£

    ![](./img/ch02_img/BitTorrentæ¦‚è¿°.png)

    - BitTorrentè¯·æ±‚å’Œå‘é€æ–‡ä»¶å—
        - è¯·æ±‚æ–‡ä»¶å—
            - åœ¨ä»»ä½•ç»™å®šçš„æ—¶åˆ»ï¼Œæ¯ä¸ªå¯¹ç­‰æ–¹å°†å…·æœ‰æ¥è‡ªè¯¥æ–‡ä»¶çš„å—çš„å­é›†ï¼Œå¹¶ä¸”ä¸åŒçš„å¯¹ç­‰æ–¹å…·æœ‰ä¸åŒçš„å­é›†ã€‚
            - å‘¨æœŸæ€§åœ°ï¼ˆç»TCPè¿æ¥ï¼‰è¯¢é—®æ¯ä¸ªé‚»è¿‘å¯¹ç­‰æ–¹æ‰€å…·æœ‰çš„å—åˆ—è¡¨ã€‚
            - å¯¹è¿˜æ²¡æœ‰çš„å—å‘å‡ºTCPè¯·æ±‚ã€‚
            - ä½¿ç”¨æœ€ç¨€ç¼ºä¼˜å…ˆï¼ˆrarest firstï¼‰æŠ€æœ¯ï¼šå¯ä»¥å‡è¡¡æ¯ä¸ªå—åœ¨æ´ªæµä¸­çš„å‰¯æœ¬æ•°é‡ã€‚
        - å‘é€æ–‡ä»¶å—ï¼šä½¿ç”¨tit-for-tat
            - ä»¥æœ€é«˜é€Ÿç‡æä¾›æ•°æ®çš„é‚»å±…ï¼Œç»™å‡ºå…¶ä¼˜å…ˆæƒã€‚
            - ç–é€šï¼ˆunchokedï¼‰ï¼šæ¯4ä¸ªå¯¹ç­‰æ–¹ã€‚
            - æ¯30séšæœºé€‰æ‹©å¦ä¸€ä¸ªé‚»å±…å¹¶å‘å…¶å‘é€å—ã€‚

### 6.3 åˆ†å¸ƒå¼æ•£åˆ—è¡¨
åˆ†å¸ƒå¼æ•£åˆ—è¡¨æ˜¯ä¸€ç§ç®€å•çš„æ•°æ®åº“ã€‚

å…è®¸ä»»ä½•å¯¹ç­‰æ–¹ç”¨ä¸€ä¸ªç‰¹åˆ«çš„é”®æ¥æŸ¥è¯¢è¯¥åˆ†å¸ƒå¼æ•°æ®åº“ã€‚åˆ†å¸ƒå¼æ•°æ®åº“åˆ™å®šä½æ‹¥æœ‰è¯¥ç›¸åº”ï¼ˆé”®ï¼Œå€¼ï¼‰å¯¹çš„å¯¹ç­‰æ–¹ï¼Œç„¶åå‘æŸ¥è¯¢çš„å¯¹ç­‰æ–¹è¿”å›ï¼ˆé”®ï¼Œå€¼ï¼‰å¯¹ã€‚

ä»»ä½•å¯¹ç­‰æ–¹ä¹Ÿå…è®¸åœ¨æ•°æ®åº“ä¸­æ’å…¥æ–°é”®-å€¼å¯¹ã€‚

- å“ˆå¸Œè¡¨
- DHTæ–¹æ¡ˆ
- ç¯å½¢DHTä»¥åŠè¦†ç›–ç½‘ç»œ
- Peeræ³¢åŠ¨

å†…å®¹è¯´æ˜ï¼šã€Šè®¡ç®—æœºç½‘ç»œï¼šè‡ªé¡¶å‘ä¸‹æ–¹æ³•ã€‹ç¬¬6ç‰ˆæœ‰ä»‹ç»ï¼Œåç»­ç»†è¯»è¡¥å……ã€‚

## 7. CDN

### 7.1 å› ç‰¹ç½‘è§†é¢‘
- è§†é¢‘æµé‡ï¼šå æ®äº’è”ç½‘å¤§éƒ¨åˆ†çš„å¸¦å®½
- æŒ‘æˆ˜
    - è§„æ¨¡æ€§ï¼šå¦‚ä½•æœåŠ¡æ›´å¤šç”¨æˆ·ï¼Ÿ
    - å¼‚æ„æ€§ï¼šä¸åŒç”¨æˆ·æ‹¥æœ‰ä¸åŒçš„èƒ½åŠ›ï¼ˆæœ‰çº¿æˆ–è€…æ— çº¿æ¥å…¥ï¼‰
- è§£å†³æ–¹æ¡ˆï¼šåˆ†å¸ƒå¼çš„ï¼Œåº”ç”¨å±‚é¢çš„åŸºç¡€è®¾æ–½ã€‚

### 7.2 å¤šåª’ä½“ï¼šè§†é¢‘

![](./img/ch02_img/å¤šåª’ä½“è§†é¢‘.png)

### 7.3 å¤šåª’ä½“æµåŒ–æœåŠ¡ï¼šDASH
- DASHï¼šDynamic, Adaptive Streaming Over HTTPï¼ˆåŠ¨æ€è‡ªé€‚åº”æµåŒ–HTTPï¼‰
    - è§£æåº¦ä¸åŒï¼Œå¦‚ï¼š720ã€1840ã€4kç­‰

- æœåŠ¡å™¨
    - å°†æ¯ä¸ªè§†é¢‘åˆ†å‰²æˆå¤šä¸ªå—
    - æ¯ä¸ªå—ç‹¬ç«‹å­˜å‚¨ï¼Œç¼–ç äºä¸åŒç ç‡ï¼ˆ8-10ç§ï¼‰
    - å‘Šç¤ºæ–‡ä»¶ï¼ˆmanifest fileï¼‰ï¼šæä¾›ä¸åŒçš„å—çš„URL
- å®¢æˆ·ç«¯
    - å…ˆè·å–å‘Šç¤ºæ–‡ä»¶
    - å‘¨æœŸæ€§åœ°æµ‹é‡æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„å¸¦å®½
    - æŸ¥è¯¢å‘Šç¤ºæ–‡ä»¶ï¼Œåœ¨ä¸€ä¸ªæ—¶åˆ»è¯·æ±‚ä¸€ä¸ªå—ï¼ŒHTTPå¤´éƒ¨æŒ‡å®šå­—èŠ‚èŒƒå›´ã€‚
        - å¦‚æœå¸¦å®½è¶³å¤Ÿï¼Œé€‰æ‹©æœ€å¤§ç ç‡çš„è§†é¢‘å—ã€‚
        - ä¼šè¯ä¸­çš„ä¸åŒæ—¶åˆ»ï¼Œå¯ä»¥åˆ‡æ¢è¯·æ±‚ä¸åŒçš„ç¼–ç å—ï¼ˆå–å†³äºå½“æ—¶çš„å¸¦å®½ï¼‰
- â€œæ™ºèƒ½â€å®¢æˆ·ç«¯ï¼šå®¢æˆ·ç«¯è‡ªé€‚åº”å†³å®š
    - ä½•æ—¶å»è¯·æ±‚å—ï¼ˆé¿å…ç¼“å­˜æŒ¨é¥¿æˆ–è€…æº¢å‡ºï¼‰
    - è¯·æ±‚ä»€ä¹ˆç¼–ç é€Ÿç‡çš„è§†é¢‘å—ï¼ˆå½“å¸¦å®½å¤Ÿç”¨æ—¶ï¼Œè¯·æ±‚é«˜è´¨é‡çš„è§†é¢‘å—ï¼‰
    - å“ªé‡Œå»è¯·æ±‚å—ï¼ˆå¯ä»¥å‘ç¦»è‡ªå·±æœ€è¿‘çš„æœåŠ¡å™¨å‘é€URLã€æˆ–è€…å‘é«˜å¯ç”¨å¸¦å®½çš„æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼‰
    - ä¾‹å­
        - è§†é¢‘çš„æ¸…æ™°åº¦

### 7.4 å†…å®¹åˆ†å‘ç½‘ç»œ
Content Distribution Networkï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼ŒCDNï¼‰

- æŒ‘æˆ˜ï¼š
    - è§†é¢‘æµå…¬å¸æœåŠ¡å™¨å¦‚ä½•é€šè¿‡ç½‘ç»œå‘ç™¾ä¸‡è®¡ç”¨æˆ·æä¾›æµåŒ–è§†é¢‘å†…å®¹ï¼Ÿ
- è§£å†³æ–¹æ¡ˆ1ï¼šå•ä¸ªè¶…å¤§å‹çš„æ•°æ®æœåŠ¡å™¨ä¸­å¿ƒ
    - å­˜åœ¨é—®é¢˜ï¼š
        - æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯è·¯å¾„ä¸Šç»è¿‡çš„é€šä¿¡é“¾è·¯è¿‡å¤šï¼Œå¯¼è‡´é“¾è·¯ä¸Šçš„ååé‡è¿‡å°ï¼Œä»è€Œå‡ºç°åœæ»æ—¶å»¶ã€‚
        - åŒä¸€ä¸ªè§†é¢‘çš„å¤šæ¬¡æ‹·è´ï¼Œå¯¼è‡´å¸¦å®½æµªè´¹ã€‚
        - å•ä¸ªèŠ‚ç‚¹æ•…éšœï¼Œä¼šä½¿é€šä¿¡é“¾è·¯å´©æºƒï¼Œä½¿å¾—æ— æ³•åˆ†å‘è§†é¢‘ã€‚
        - å¯æ‰©å±•æ€§è¾ƒå·®

- è§£å†³æ–¹æ¡ˆ2:CDN
    - é€šè¿‡CDNï¼Œå…¨ç½‘éƒ¨ç½²ç¼“å­˜èŠ‚ç‚¹ã€‚å­˜å‚¨æœåŠ¡å†…å®¹ï¼Œå°±è¿‘ä¸ºç”¨æˆ·æä¾›æœåŠ¡ï¼Œæé«˜ç”¨æˆ·ä½“éªŒã€‚
    - Enter deepï¼šå°†CDNæœåŠ¡æ·±å…¥åˆ°è®¸å¤šæ¥å…¥ç½‘
        - æ›´æ¥è¿‘ç”¨æˆ·ï¼Œæ•°é‡å¤šï¼Œç¦»ç”¨æˆ·è¿‘ï¼Œä½†æ˜¯ç®¡ç†å›°éš¾
    - Bring homeï¼šéƒ¨ç½²åœ¨å°‘æ•°ï¼ˆ10ä¸ªå·¦å³ï¼‰å…³é”®ä½ç½®ã€‚
        - é‡‡ç”¨ç§Ÿèµçº¿è·¯å°†æœåŠ¡å™¨ç°‡è¿æ¥èµ·æ¥ã€‚
    - ç”¨æˆ·ä»CDNä¸­è¯·æ±‚å†…å®¹ï¼Œé‡å®šå‘åˆ°æœ€è¿‘çš„æ‹·è´ï¼Œè¯·æ±‚å†…å®¹ã€‚

- CDNçš„ç±»å‹
    - ä¸“ç”¨CDNï¼ˆprivate CDNï¼‰ï¼šå†…å®¹æä¾›å•†è‡ªæœ‰ã€‚
    - ç¬¬ä¸‰æ–¹CDNï¼ˆthird- party CDNï¼‰ï¼šç¬¬ä¸‰æ–¹å…¬å¸æä¾›ã€‚

## 8. Socketç¼–ç¨‹
Socketï¼ˆå¥—æ¥å­—ï¼‰ç¼–ç¨‹

åº”ç”¨è¿›ç¨‹ä½¿ç”¨ä¼ è¾“å±‚æä¾›çš„æœåŠ¡æ‰èƒ½å¤Ÿäº¤æ¢æŠ¥æ–‡ï¼Œå®ç°åº”ç”¨åè®®ï¼Œå®ç°åº”ç”¨ã€‚
- TCP/IPï¼šåº”ç”¨è¿›ç¨‹ä½¿ç”¨Socket APIè®¿é—®ä¼ è¾“æœåŠ¡ã€‚
- åœ°ç‚¹ï¼šç•Œé¢ä¸Šçš„SAPï¼ˆSocketï¼‰
- æ–¹å¼ï¼šSocket API

- socketç¼–ç¨‹
    
    ä¸¤ç§ä¼ è¾“å±‚æœåŠ¡çš„socketç±»å‹ï¼š
    - TCPï¼šå¯é çš„ã€å­—èŠ‚æµçš„æœåŠ¡
    - UDPï¼šä¸å¯é ï¼ˆUDPæ•°æ®æŠ¥ï¼‰æœåŠ¡

ç›®æ ‡ï¼š
- å­¦ä¹ å¦‚ä½•æ„å»ºèƒ½å€ŸåŠ©Socketè¿›è¡Œé€šä¿¡çš„C/Såº”ç”¨ç¨‹åºã€‚

### 8.1 TCP å¥—æ¥å­—ç¼–ç¨‹
**`Socket`**ï¼šåˆ†å¸ƒå¼åº”ç”¨è¿›ç¨‹ä¹‹é—´çš„é—¨ï¼Œä¼ è¾“åè®®æä¾›çš„ç«¯åˆ°ç«¯æœåŠ¡æ¥å£ã€‚

**`å¥—æ¥å­—`**ï¼šåº”ç”¨è¿›ç¨‹ä¸ç«¯åˆ°ç«¯ä¼ è¾“åè®®ï¼ˆTCPæˆ–UDPï¼‰ä¹‹é—´çš„é—¨æˆ·ã€‚

**`TCPæœåŠ¡`**ï¼šä»ä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å¯é åœ°ä¼ è¾“å­—èŠ‚æµã€‚

![](./img/ch02_img/socketæ¥å£ç¤ºæ„å›¾.png)

- æœåŠ¡å™¨é¦–å…ˆè¿è¡Œï¼Œç­‰å¾…è¿æ¥å»ºç«‹
    - æœåŠ¡å™¨è¿›ç¨‹å¿…é¡»å¤„äºè¿è¡ŒçŠ¶æ€
        - åˆ›å»ºæ¬¢è¿socket
        - å’Œæœ¬åœ°ç«¯å£æ†ç»‘
        - åœ¨æ¬¢è¿socketä¸Šé˜»å¡å¼ç­‰å¾…æ¥æ”¶ç”¨æˆ·çš„è¿æ¥ã€‚
- å®¢æˆ·ç«¯ä¸»åŠ¨å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥
    - åˆ›å»ºå®¢æˆ·ç«¯æœ¬åœ°å¥—æ¥å­—ï¼ˆéšå¼æ†ç»‘åˆ°æœ¬åœ°portï¼‰
        - æŒ‡å®šæœåŠ¡å™¨è¿›ç¨‹çš„IPåœ°å€å’Œç«¯å£å·ï¼Œä¸æœåŠ¡å™¨è¿›ç¨‹è¿æ¥ã€‚
    - å½“ä¸å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚åˆ°æ¥æ—¶
        - æœåŠ¡å™¨æ¥å—æ¥è‡ªç”¨æˆ·ç«¯çš„è¯·æ±‚ï¼Œè§£é™¤é˜»å¡å¼ç­‰å¾…ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„socketï¼ˆä¸æ¬¢è¿socketä¸ä¸€æ ·ï¼‰ï¼Œä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚
            - å…è®¸æœåŠ¡å™¨ä¸å¤šä¸ªå®¢æˆ·ç«¯é€šä¿¡
            - ä½¿ç”¨æºIPå’Œæºç«¯å£æ¥åŒºåˆ†ä¸åŒçš„å®¢æˆ·ç«¯ã€‚
- è¿æ¥APIè°ƒç”¨æœ‰æ•ˆæ—¶ï¼Œå®¢æˆ·ç«¯Pä¸æœåŠ¡å™¨å»ºç«‹TCPè¿æ¥ã€‚

TCPåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›ç¨‹ä¹‹é—´æä¾›å¯é çš„ã€å­—èŠ‚æµï¼ˆç®¡é“ï¼‰æœåŠ¡ã€‚

- å…³é”®çš„ç»“æ„ä½“
    - æ•°æ®ç»“æ„ socketaddr_in

    ```c
    // IPåœ°å€å’Œportæ†ç»‘å…³ç³»çš„æ•°æ®ç»“æ„ï¼ˆæ ‡è¯†è¿›ç¨‹çš„ç«¯èŠ‚ç‚¹ï¼‰
    struct socketaddr_in{
        short sin_family; // AF_INET
        u_short sin_port; // port
        struct in_addr sin_addr; // IP address, unsigned long
        char sin_zero[8]; // align
    };
    ```
    - æ•°æ®ç»“æ„ hostent
    
    ```c
    // åŸŸåå’ŒIPåœ°å€çš„æ•°æ®ç»“æ„
    struct hostent{
        char *h_name; // ä¸»æœºå
        char **h_aliases; // ä¸»æœºçš„åˆ«å
        int h_addrtype; // ä¸»æœºçš„åœ°å€ç±»å‹
        int h_length; // åœ°å€çš„é•¿åº¦
        char **h_addr_list; // IPåœ°å€
        #define h_addr h_addr_list[0];
    }
    // ä½œä¸ºè°ƒç”¨åŸŸåè§£æå‡½æ•°æ—¶çš„å‚æ•°
    // è¿”å›åï¼Œå°†IPåœ°å€æ‹·è´åˆ°socketaddr_in çš„IPåœ°å€éƒ¨åˆ†ã€‚
    ```

- C/S TCP socketäº¤äº’

    ![](./img/ch02_img/C-Sä¸­TCP-socketäº¤äº’.png)

- TCPå®¢æˆ·ç«¯Cä»£ç 

    ```c
    // client.c
    void main(int argc,char *argv[])
    {
        struct socketaddr_in sad; // æœåŠ¡å™¨çš„IPåœ°å€
        int clientSocket; // socketè§£é‡Šå™¨
        struct hostent *ptrh; // ä¸»æœºåˆ—è¡¨å…¥å£æŒ‡é’ˆ
        char Sentence[128];
        char modifiedSentence[128];

        host = argv[1];
        port = atoi(argv[2]); // è½¬æ¢ä¸ºæ•´å‹
        clientSocket = socket(PF_INET,SOCKET_STREAM,0); // åˆ›å»ºä¸€ä¸ªTCP socketç»™æœåŠ¡å™¨
        memset((char *)&sadm,0,sizeof(sad));// æ¸…é™¤socketaddrç»“æ„
        sad.sin_family =AF_INET; //è®¾ç½®ç½‘ç»œ
        sad.sin_port = htons((u_short)port);
        ptrh = gethostbyname(host); // è½¬æ¢host name ä¸ºIPåœ°å€
        memcpy(&sad.sin_addr,ptrh->h_addr,ptrh->h_length);// å°†IPåœ°å€æ‹·è´åˆ°sad.sin_addr
        connect(clientSocket.(struct socketaddr *)&sad,sizeof(sad)); // åˆ›å»ºclient socketå»è¿æ¥ server
        // get input stream from user
        gets(Sentence);
        // send line to server
        n = write(clientSocket,Sentence,strlen(Sentence)+1);
        // read line from server
        n = read(clientSocket,modifiedSentence,sizeof(modifiedSentence));
        printf("FROM SERVER %s \n",modifiedSentence);
        close(clientSocket);
    }
    ```
- TCPæœåŠ¡ç«¯Cä»£ç 
    
    ```c
    // server.c
    void main(int argc,char *argv[])
    {
        struct socketaddr_in sad;
        struct socketaddr_in cad;// å®¢æˆ·ç«¯
        int welcomeSocket,connecttionSocket;// socketæè¿°å™¨
        struct hostent *ptrh; // pointer to host table entry
        char clientSentence[128];
        char capitalizedSentence[128];
        port = atoi(argv[1]);
        welcomeSocket = socket(PF_INET,SOCKET_STREAM,0);
        memset((char *)&sad,sizeof(sad)); //æ¸…é™¤socketaddrç»“æ„ä¿¡æ¯
        sad.sin_addr.s_addr = INADDR_ANY; // è®¾ç½®æœ¬åœ°IPåœ°å€
        sad.sin_port = htons((u_short)port); //è®¾ç½®ç«¯å£å·
        bind(welcomeSocket,(struct socketaddr *)&sad,sizeof(sad)); // æ†ç»‘
        // æŒ‡å®šå®¢æˆ·ç«¯é˜Ÿåˆ—çš„æœ€å¤§å€¼
        listen(welcomeSocket,10); // ç›‘å¬æœ€å¤§ä¸ªæ•°
        while(1){
            connectionSocket = accept(welcomeSocket,(struct socketaddr *)&cad,&alen); // ç­‰å¾…å®¢æˆ·ç«¯çš„welcome socketçš„è¿æ¥
            n = read(connectionSocket,clientSentence,sizeof(clientSentence));
            // capitalize Sentence and store the result in capitalizedSentence
            n = write(connectionSocket,capitalizedSentence,strlen(capitalizedSentence)+1); //   å†™æœ€ç»ˆçš„ç»“æœç»™åˆ°socket
            close(connectionSocket)// whileå¾ªç¯ç»“æŸï¼Œè¿”å›ç­‰å¾…å…¶ä»–clientçš„è¿æ¥
        }
    }
    ```

### 8.2 UDP å¥—æ¥å­—ç¼–ç¨‹

UDPï¼šåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ²¡æœ‰è¿æ¥ã€‚
- æ²¡æœ‰æ¡æ‰‹
- å‘é€ç«¯åœ¨æ¯ä¸ªæŠ¥æ–‡ä¸­æ˜ç¡®æŒ‡å®šç›®æ ‡çš„IPåœ°å€å’Œç«¯å£å·
- æœåŠ¡å™¨å¿…é¡»æ”¶åˆ°çš„åˆ†ç»„ä¸­æå–å‡ºå‘é€ç«¯çš„IPåœ°å€å’Œç«¯å£å·ã€‚

UDPï¼šä¼ é€çš„æ•°æ®å¯èƒ½ä¹±åºï¼Œä¹Ÿå¯èƒ½ä¼šä¸¢å¤±ã€‚æ‰€ä»¥UDPæä¾›ä¸å¯é çš„å­—èŠ‚æµä¼ è¾“æœåŠ¡ã€‚

- C/S ä¸­UDP socketäº¤äº’

    ![](./img/ch02_img/C-Sä¸­UDP-socketäº¤äº’.png)

    - å®¢æˆ·ç«¯Cä»£ç 
    ```c
    // client.c
    void main(int argc,char *argv[])
    {
    struct socketaddr_in sad;
    int clientSocket;
    struct hostent *ptrh;
    char Sentence[128];
    char modifiedSentence[128];

    host = argv[1];port = atoi(argv[2]);

    clientSocket = socket(PF_IINET,SOCKET_DGRAM,0); // åˆ›å»ºå®¢æˆ·ç«¯ï¼Œä½†æ˜¯æ²¡æœ‰è¿æ¥åˆ°æœåŠ¡å™¨

    // determine the server address
    memset((char *)&sad,0,sizeof(sad)); // æ¸…é™¤
    sad.sin_family = AF_INET; // è®¾ç½®ç½‘ç»œ
    sad.sin_port = htons((u_short)port);
    ptrh = gethostbyname(host);
    // è½¬æ¢hoståå­—ä¸ºIPåœ°å€
    memcpy(&sad.sin_addr,ptrh->h_addr,ptrh->h_length);
    // get input stream from user
    gets(Sentence)
    // send line to server
    addr_len = sizeof(struct socketaddr);
    n = sendto(clientsocket,Sentence,strlen(Sentence)+1,
                (struct socketaddr *)&sad,addr_len);
    // read line from server
    n =recvfrom(clientSocket,modifiedSentence,sizeof(modifiedSentence),
                (struct socketaddr *)&sad,&addr_len);

    printf("FROM SERVER : %s \n",modifiedSentence);
    close(clientSocket); // å…³é—­è¿æ¥
    }
    ```
    - æœåŠ¡å™¨ç«¯Cä»£ç 
    ```c
    // server.c
        void main(int argc,char *argv[])
    {
        struct socketaddr_in sad;
        struct socketaddr_in cad;// å®¢æˆ·ç«¯
        int serversocket;// socketæè¿°å™¨
        struct hostent *ptrh; // pointer to host table entry
        char clientSentence[128];
        char capitalizedSentence[128];
        port = atoi(argv[1]);
        serversocket = socket(PF_INET,SOCKET_STREAM,0);
        // åˆ›å»º welcomeming socket at portï¼Œå¹¶æ†ç»‘æœ¬åœ°åœ°å€
        memset((char *)&sad,sizeof(sad)); //æ¸…é™¤socketaddrç»“æ„ä¿¡æ¯
        sad.sin_family = AF_INET;// è®¾ç½®ç½‘ç»œç°‡
        sad.sin_addr.s_addr = INADDR_ANY; // è®¾ç½®æœ¬åœ°IPåœ°å€
        sad.sin_port = htons((u_short)port); //è®¾ç½®ç«¯å£å·
        bind(serversocket,(struct socketaddr *)&sad,sizeof(sad)); // æ†ç»‘
        // æŒ‡å®šå®¢æˆ·ç«¯é˜Ÿåˆ—çš„æœ€å¤§å€¼
        listen(welcomeSocket,10); // ç›‘å¬æœ€å¤§ä¸ªæ•°
        while(1){
            // æ¥æ”¶æ¥è‡ªclientçš„æŠ¥æ–‡ä¿¡æ¯
            n =recvfrom(serverSocket,clientSentence,sizeof(clientSentence),
                    (struct socketaddr *)&cad,&addr_len);
            // å¤§å†™çš„è½¬æ¢
            n = sendto(serverSocket,capitalizedSentence,strlen(capitalizedSentence)+1,
                    (struct socketaddr *)&cad,&addr_len);
            close(connectionSocket)// whileå¾ªç¯ç»“æŸï¼Œè¿”å›ç­‰å¾…å…¶ä»–clientçš„è¿æ¥
        }
    }
    ```


